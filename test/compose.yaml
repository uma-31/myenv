services:
  gitea:
    image: docker.gitea.com/gitea:latest
    restart: always
    environment:
      - GITEA__server__DISABLE_SSH=true
      - GITEA__security__INSTALL_LOCK=true
      - GITEA__repository__ENABLE_PUSH_CREATE_USER=true
      - GITEA__repository__DEFAULT_PUSH_CREATE_PRIVATE=false
    volumes:
      - type: volume
        source: gitea-data
        target: /data
      - type: bind
        source: /etc/timezone
        target: /etc/timezone
        read_only: true
      - type: bind
        source: /etc/localtime
        target: /etc/localtime
        read_only: true
    ports:
      - target: 3000
        published: ${MYENV_TEST__GITEA_PORT}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/healthz"]
      interval: 3s
      timeout: 3s
      retries: 10
      start_period: 10s

  ubuntu:
    build:
      context: .
      dockerfile: Dockerfile

volumes:
  gitea-data:
